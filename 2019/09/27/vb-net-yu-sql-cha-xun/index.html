<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="VB.NET与sql查询, Jerry&#39;s Blog">
    <meta name="description" content="因为开发了一个查询的小工具，满足自己日常工作时查询数据使用，记录开发中遇到的一些问题与解决方法，
主要是vb.net控件的一些属性和SQL查询语句，毕竟只会一点vba，切换到vb会简单一些，而且窗体设计更直观。
涉及到SQL查询，是因为数据">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VB.NET与sql查询 | Jerry&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Jerry's Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Jerry's Blog</div>
        <div class="logo-desc">
            
            Linux
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/zcyang668" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/zcyang668" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>





<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/16.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        VB.NET与sql查询
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/vb-NET-sql查询/" target="_blank">
                                <span class="chip bg-color">-vb.NET -sql查询</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/vb-net/" class="post-category" target="_blank">
                                vb.net
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2019-09-27
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        2.6k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        13 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>因为开发了一个查询的小工具，满足自己日常工作时查询数据使用，记录开发中遇到的一些问题与解决方法，</p>
<p>主要是<code>vb.net</code>控件的一些属性和<code>SQL</code>查询语句，毕竟只会一点<code>vba</code>，切换到<code>vb</code>会简单一些，而且窗体设计更直观。</p>
<p>涉及到<code>SQL</code>查询，是因为数据都是存储在服务器的<code>SQL server</code>数据库中，数据库由公司使用的Kindee软件创建，直接拿来查询就行了，希望以后能涉及到增删改的操作。</p>
<p>因为一开始需要的功能是根据自己的需要一点点添加的，也没像标准开发流程那样，写功能及实现的流程图，使用的开发工具是<code>VisualStudio2019</code>,</p>
<ul>
<li>创建了一个主界面</li>
</ul>
<p><img src="/2019/09/27/vb-net-yu-sql-cha-xun/main.png" alt="main"></p>
<p>为的就是把功能分开，这时候类是什么都不懂，所以写了很多重复代码,创建这个窗体还是很简单，在窗体上添加四个按钮<code>button</code>和一个标签<code>label</code>控件就行,各自的<code>text</code>属性及上方出现的文字,四个按钮要实现的功能很简单，点击时弹出相应的查询窗口，标签的功能也是，点击时，使窗口在<code>置顶显示</code>和<code>取消置顶</code>之间切换。如下代码，使用<code>.show()</code>弹出相应窗口。标签的<code>text</code>属性搭配<code>if</code>语句展示功能，窗体的<code>.TopMost</code>属性切换是否置顶</p>
<pre class="line-numbers language-vbnet"><code class="language-vbnet">Public Class Main
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        XHCX.Show()
    End Sub
    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        YLCX.Show()
    End Sub
    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        CRKCX.Show()
    End Sub
    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        FLHZCX.Show()
    End Sub
    Private Sub Label1_Click(sender As Object, e As EventArgs) Handles Label1.Click
        If Label1.Text = "点我置顶" Then
            Me.TopMost = True
            Label1.Text = "点我取消"
        Else
            Me.TopMost = False
            Label1.Text = "点我置顶"
        End If
    End Sub
End Class<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>按型号查询</li>
</ul>
<p><img src="/2019/09/27/vb-net-yu-sql-cha-xun/xhcx.png" alt="XHCX"></p>
<p>主要是标签<code>label</code>和文本框<code>textbox</code>控件，再加一个日期<code>DataPicker</code>控件</p>
<pre class="line-numbers language-vbnet"><code class="language-vbnet">Imports System.Data.SqlClient

Public Class XHCX
    Dim query, query1 As String
定义enter键转到button功能
    Private Sub TextBox1_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles TextBox1.KeyDown
        If e.KeyCode = Keys.Enter Then
            Button1_Click(sender, e)
        End If
    End Sub
定义按钮点击的功能
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        'On Error Resume Next
定义一些SQL查询语句
        query1 = "SELECT CONVERT(int,SUM(FWIPQty)) AS ZZhiPin,FItemID AS XHao,FItemName AS YLiao,CONVERT(FLOAT,FQtyScrap) AS DZhong, FWorkName FROM AIS20180425162956.dbo.View_PPBOM_Y02 WHERE  FItemID LIKE '%" & TextBox1.Text & "%'  AND FDate > '" & DateTimePicker1.Value & "' GROUP BY FWorkName,FItemID,FItemName,FQtyScrap ORDER BY FItemID"  '在制品查询
        query = "SELECT CONVERT(int,SUM(FQty)) AS Qty,FMaterialName AS MName,FMaterialParentID AS MPID,FStockID AS FSID FROM AIS20180425162956.dbo.vwStockQuery  GROUP BY FMaterialParentID,FStockID,FMaterialName" '库存查询
        'mySQL3 = "SELECT SUM(FQty) FROM AIS20180425162956.dbo.vwStockQuery WHERE FMaterialNumber LIKE '%" & itnum & "%' AND FMaterialParentID = '2397' AND FStockID = '302'"   '半成品查询
        'mySQL4 = "SELECT SUM(FQty) FROM AIS20180425162956.dbo.vwStockQuery WHERE FMaterialNumber LIKE '%" & itnum & "%' AND FMaterialParentID = '1092' AND FStockID = '303'"   '成品查询
        'mySQL7 = " SELECT FQty FROM AIS20180425162956.dbo.vwStockQuery WHERE FMaterialName LIKE '%" & ittext6 & "%'  AND FStockName = '原材料库'"   '原材料库存查询

使用linq查询table，其实我觉得还不如直接写SQL语句
        Dim dt1 As DataTable = GetData(query1)
        Dim dt As DataTable = GetData(query)
        Dim x = (From p In dt1.AsEnumerable() Where p.Field(Of String)("FWorkName") = "精加工车间" Order By p.Field(Of String)("XHao") Select p.Field(Of Integer)("ZZhiPin")).ToArray()
        Dim y = (From p In dt1.AsEnumerable() Where p.Field(Of String)("FWorkName") = "表面处理车间" Order By p.Field(Of String)("XHao") Select p.Field(Of Integer)("ZZhiPin")).ToArray()
        Dim z = (From p In dt1.AsEnumerable() Where p.Field(Of String)("FWorkName") = "锻打车间" Order By p.Field(Of String)("XHao") Select p.Field(Of String)("YLiao")).ToArray() '产品用料
        Dim u = (From p In dt1.AsEnumerable() Where p.Field(Of String)("FWorkName") = "锻打车间" Order By p.Field(Of String)("XHao") Select p.Field(Of Double)("DZhong")).ToArray() '单只重量
        Dim m = "*" + TextBox1.Text + "*"
        TextBox5.Text = x(0)
        TextBox3.Text = y(0)
        TextBox7.Text = z(0)
        TextBox9.Text = u(0)

        Dim a = (From v In dt.AsEnumerable() Where v.Field(Of Integer)("FSID") = "302" And v.Field(Of Integer)("MPID") = "612" And v.Field(Of String)("MName") Like m Select v.Field(Of Integer)("Qty")).ToArray() '毛坯库存
        Dim b = (From v In dt.AsEnumerable() Where v.Field(Of Integer)("FSID") = "302" And v.Field(Of Integer)("MPID") = "2397" And v.Field(Of String)("MName") Like m Select v.Field(Of Integer)("Qty")).ToArray() '半成品库存
        Dim c = (From v In dt.AsEnumerable() Where v.Field(Of Integer)("FSID") = "303" And v.Field(Of Integer)("MPID") = "1092" And v.Field(Of String)("MName") Like m Order By v.Field(Of Integer)("Qty") Descending Select v.Field(Of Integer)("Qty")).ToArray() '成品库存
        Dim d = (From v In dt.AsEnumerable() Where v.Field(Of String)("MName") = TextBox7.Text Select v.Field(Of Integer)("Qty")).ToArray() '原材料库存

        TextBox4.Text = a(0)
        TextBox6.Text = b(0)
        TextBox2.Text = c(0)
        TextBox8.Text = d(0)  '原材料库存
        If TextBox7.Text = "" Then
            MsgBox("未查到此型号，型号可能有误，请用K3确认")
        End If
        TextBox1.SelectAll()
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        'GJCX.Show()
    End Sub
同样置顶与取消置顶
    Private Sub Label12_Click(sender As Object, e As EventArgs) Handles Label12.Click
        If Label12.Text = "点我置顶" Then
            Me.TopMost = True
            Label12.Text = "点我取消"
        Else
            Me.TopMost = False
            Label12.Text = "点我置顶"
        End If
    End Sub

    两个查询用的function
    Private Shared Function GetData(ByVal query As String) As DataTable
        Dim constr As String = "Data Source=192.168.10.23;Initial Catalog=AIS20180425162956;Persist Security Info=false;User ID=sa;Password=a.0"
        Using con As SqlConnection = New SqlConnection(constr)
            Using sda As SqlDataAdapter = New SqlDataAdapter(query, con)
                Dim dt As DataTable = New DataTable()
                sda.Fill(dt)
                Return dt
            End Using
        End Using
    End Function
    Private Shared Function GetDa(ByVal query1 As String) As DataTable
        Dim constr As String = "Data Source=192.168.10.23;Initial Catalog=AIS20180425162956;Persist Security Info=false;User ID=sa;Password=a.0"
        Using con As SqlConnection = New SqlConnection(constr)
            Using sda1 As SqlDataAdapter = New SqlDataAdapter(query1, con)
                Dim dt1 As DataTable = New DataTable()
                sda1.Fill(dt1)
                Return dt1
            End Using
        End Using
    End Function
End Class<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>用料查询界面</li>
</ul>
<p><img src="/2019/09/27/vb-net-yu-sql-cha-xun/ylcx.png" alt="YLCX"></p>
<p>主要使用<code>DataGridView</code>绑定查询到的数据表，并在查询按钮点击后增加一列用于计算<br>计算一列的和，使用<code>sum+=</code></p>
<pre class="line-numbers language-vbnet"><code class="language-vbnet">Imports System.Data.SqlClient
Public Class YLCX
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        On Error Resume Next
        Dim cn As SqlConnection
        Dim da1, da2 As SqlDataAdapter
        Dim ds1, ds2 As DataSet
        Dim mysql1, mysql2 As String
        Dim ittext
        Dim cnStr As String = "Data Source=192.168.10.23;Initial Catalog=AIS20180425162956;Persist Security Info=false;User ID=sa;Password=a.0;"
        mysql1 = " SELECT FName  AS '产品型号', convert(float,FChildQty) AS '单只重量' FROM AIS20180425162956.dbo.vICBOM WHERE  FChildName like '%" & ComboBox1.Text & "φ" & ComboBox2.Text & "%' AND FUseStatus = '使用'"
        mysql2 = " SELECT SUM(FQty) AS FQty FROM AIS20180425162956.dbo.vwStockQuery WHERE FMaterialName LIKE '%" & ComboBox1.Text & "φ" & ComboBox2.Text & "%'  AND FStockName = '原材料库'"   '原材料查询
        cn = New SqlConnection(cnStr) '打开数据库
        da1 = New SqlDataAdapter(mysql1, cn)
        da2 = New SqlDataAdapter(mysql2, cn)
        ds1 = New DataSet()
        ds2 = New DataSet()
        da1.Fill(ds1, mysql1)
        da2.Fill(ds2, mysql2)
        TextBox1.Text = 0.0
        If ds2.Tables IsNot Nothing Then
            DataGridView1.Columns.Clear()   '先清空一下，避免每次查询时都会增加一列
            DataGridView1.DataSource = ds1.Tables(mysql1)
            DataGridView1.Columns(0).AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells
            DataGridView1.Columns(0).ReadOnly = True
            DataGridView1.Columns(1).ReadOnly = True
            DataGridView1.Columns(2).ReadOnly = False
            DataGridView1.Columns.Add(2, "输入预下单数量")
            ittext = ds2.Tables(mysql2).Rows(0).Item("FQty")
            TextBox1.Text = Math.Round(ittext, 1)               '原材料重量，用math函数和SQL语句中使用convert转换数据类型效果一样
        Else
            TextBox1.Text = 0.0
            DataGridView1.DataSource = ds1.Tables(mysql1)
        End If
    End Sub
    Private Sub Label4_Click(sender As Object, e As EventArgs) Handles Label4.Click
        If Label4.Text = "点我置顶" Then
            Me.TopMost = True
            Label4.Text = "点我取消"
        Else
            Me.TopMost = False
            Label4.Text = "点我置顶"
        End If
    End Sub
    Private Sub DataGridView1_CellEndEdit(sender As Object, e As DataGridViewCellEventArgs) Handles DataGridView1.CellEndEdit
        'Button2_Click(sender, e)
        Dim sum As Integer = 0
        For i As Integer = 0 To DataGridView1.Rows.Count - 1
        '计算新增一列的合计
            sum += (DataGridView1.Rows(i).Cells(1).Value * DataGridView1.Rows(i).Cells(2).Value)
            TextBox2.Text = TextBox1.Text - sum
        Next
    End Sub
End Class<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>入库查询分析主要使用<code>chart</code>控件绘制折线图</li>
</ul>
<p>使用<code>linq</code>将SQL查询的结果转换为数组<code>array</code></p>
<p><img src="/2019/09/27/vb-net-yu-sql-cha-xun/rkcx.png" alt="RKCX"></p>
<pre class="line-numbers language-vbnet"><code class="language-vbnet">'Imports System.Data
Imports System.Data.SqlClient
'Imports System.Configuration
Imports System.Windows.Forms.DataVisualization.Charting
Imports System.Drawing.Printing

Public Class CRKCX
    Dim query As String
    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        If Button3.Text = "每周趋势" Then
            query = "set datefirst 1 SELECT convert(int,SUM(FBaseQty)) AS 'qty' ,FDepartment AS Dept,datepart(week,FDate) AS week  FROM AIS20180425162956.dbo.vwRK WHERE  FDCStockIDNumber = '02' AND FDepartment in ('锻打车间','精加工车间','金工车间')  AND FDate > '" & DateTimePicker1.Value & "' GROUP BY FDepartment,datepart(week,FDate)"  '入库每周
            Button3.Text = "每月趋势"
        ElseIf Button3.Text = "每月趋势" Then
            query = "set datefirst 1 SELECT convert(int,SUM(FBaseQty)) AS 'qty' ,FDepartment AS Dept,datepart(month,FDate) AS week FROM AIS20180425162956.dbo.vwRK WHERE  FDCStockIDNumber = '02' AND FDepartment in ('锻打车间','精加工车间','金工车间')  AND FDate > '" & DateTimePicker1.Value & "' GROUP BY FDepartment,datepart(month,FDate)"  '入库每周
            Button3.Text = "每周趋势"
        End If
        Dim dt As DataTable = GetData(query)

        Dim partments As List(Of String) = (From p In dt.AsEnumerable Select p.Field(Of String)("Dept")).Distinct().ToList()

        Chart1.Series.Clear()

        For Each partment As String In partments
            Dim x As Integer() = (From p In dt.AsEnumerable() Where p.Field(Of String)("Dept") = partment Order By p.Field(Of Integer)("week") Select p.Field(Of Integer)("week")).ToArray()
            Dim y As Integer() = (From p In dt.AsEnumerable() Where p.Field(Of String)("Dept") = partment Order By p.Field(Of Integer)("week") Select p.Field(Of Integer)("qty")).ToArray()
            Chart1.Series.Add(New Series(partment))
            Chart1.Series(partment).IsValueShownAsLabel = True
            Chart1.Series(partment).BorderWidth = 3
            Chart1.Series(partment).ChartType = SeriesChartType.Line
            Chart1.Series(partment).SmartLabelStyle.MaxMovingDistance = 50
            Chart1.Series(partment).Points.DataBindXY(x, y)
            For i As Integer = 0 To Chart1.Series(partment).Points.Count - 1
                Chart1.Series(partment).Points(i).ToolTip = Chart1.Series(partment).Name & Chart1.Series(partment).Points(i).GetValueByName("y")
            Next
        Next
        Chart1.Legends(0).Enabled = True
        Chart1.Legends(0).IsTextAutoFit = True
        Chart1.Legends(0).Docking = Docking.Bottom
    End Sub

    Private Sub CRKCX_Load(sender As Object, e As EventArgs) Handles MyBase.Load

        query = "set datefirst 1 SELECT convert(int,SUM(FBaseQty)) AS 'qty' ,FDepartment AS Dept,datepart(week,FDate) AS week  FROM AIS20180425162956.dbo.vwRK WHERE  FDCStockIDNumber = '02'  AND FDepartment in ('锻打车间','精加工车间','金工车间') AND FDate > '20190101'  GROUP BY FDepartment,datepart(week,FDate)"
        Dim dt As DataTable = GetData(query)
        '部门转换为列表
        Dim partments As List(Of String) = (From p In dt.AsEnumerable() Select p.Field(Of String)("Dept")).Distinct().ToList()
        If Chart1.Series.Count() = 1 Then
            Chart1.Series.Clear()
        End If
        '转换数组
        For Each partment As String In partments
            Dim x As Integer() = (From p In dt.AsEnumerable() Where p.Field(Of String)("Dept") = partment Order By p.Field(Of Integer)("week") Select p.Field(Of Integer)("week")).ToArray()
            Dim y As Integer() = (From p In dt.AsEnumerable() Where p.Field(Of String)("Dept") = partment Order By p.Field(Of Integer)("week") Select p.Field(Of Integer)("qty")).ToArray()
            '设置chart属性，各部门为图例
            Chart1.Series.Add(New Series(partment))
            Chart1.Series(partment).IsValueShownAsLabel = True
            Chart1.Series(partment).BorderWidth = 3
            Chart1.Series(partment).ChartType = SeriesChartType.Line
            Chart1.Series(partment).SmartLabelStyle.MaxMovingDistance = 50
            Chart1.Series(partment).Points.DataBindXY(x, y)
            '设置鼠标移动到坐标点显示数据详情
            For i As Integer = 0 To Chart1.Series(partment).Points.Count - 1
                Chart1.Series(partment).Points(i).ToolTip = Chart1.Series(partment).Name & Chart1.Series(partment).Points(i).GetValueByName("y")
            Next
        Next
        Chart1.Legends(0).Enabled = True
        Chart1.Legends(0).IsTextAutoFit = True
        Chart1.Legends(0).Docking = Docking.Bottom
    End Sub
    'function连接数据库获取数据
    Private Shared Function GetData(ByVal query As String) As DataTable
        Dim constr As String = "Data Source=192.168.10.23;Initial Catalog=AIS20180425162956;Persist Security Info=false;User ID=sa;Password=a.0"
        Using con As SqlConnection = New SqlConnection(constr)
            Using sda As SqlDataAdapter = New SqlDataAdapter(query, con)
                Dim dt As DataTable = New DataTable()
                sda.Fill(dt)
                Return dt
            End Using
        End Using
    End Function

End Class<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《VB.NET与sql查询》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2019/09/27/vb-net-yu-sql-cha-xun/" property="cc:attributionName"
               rel="cc:attributionURL">
                Jerry
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    

    

    

    
    <div class="livere-card card" data-aos="fade-up">
    <!-- 来必力City版安装代码 -->
    <div id="lv-container" class="card-content" data-id="city" data-uid="MTAyMC80NjM1Ni8yMjg2Nw==">
        <script type="text/javascript">
            (function (d, s) {
                let j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') {
                    return;
                }

                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>为正常使用来必力评论功能请激活JavaScript。</noscript>
    </div>
    <!-- City版安装代码已完成 -->
</div>
    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-dot-circle-o"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2019/09/27/vb-net-yu-sql-cha-xun/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/16.jpg" class="responsive-img" alt="VB.NET与sql查询">
                        
                        <span class="card-title">VB.NET与sql查询</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            因为开发了一个查询的小工具，满足自己日常工作时查询数据使用，记录开发中遇到的一些问题与解决方法，
主要是vb.net控件的一些属性和SQL查询语句，毕竟只会一点vba，切换到vb会简单一些，而且窗体设计更直观。
涉及到SQL查询，是因为数据
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-09-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/vb-net/" class="post-category" target="_blank">
                                    vb.net
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/vb-NET-sql查询/" target="_blank">
                        <span class="chip bg-color">-vb.NET -sql查询</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2019/09/08/wo-de-duan-duan-xu-xu/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="我的断断续续">
                        
                        <span class="card-title">我的断断续续</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
昨天的我见朋友、听故事、吃狗粮、学经验、长见识，今天的我还是不喜欢跟他们说话

昨天才发现真是很久没聊过天了，也没听人聊过天了，是真的聊天，无所顾忌的，在社会圈子里和朋友圈确实不能一样，毕竟病从口入，祸从口出。
有朋自远方来不亦乐乎，很久
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-09-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/随笔/" class="post-category" target="_blank">
                                    随笔
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/经验/" target="_blank">
                        <span class="chip bg-color">经验</span>
                    </a>
                    
                    <a href="/tags/恋爱/" target="_blank">
                        <span class="chip bg-color">恋爱</span>
                    </a>
                    
                    <a href="/tags/社交/" target="_blank">
                        <span class="chip bg-color">社交</span>
                    </a>
                    
                    <a href="/tags/狗粮/" target="_blank">
                        <span class="chip bg-color">狗粮</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://zcyang668.github.io/" target="_blank">Jerry</a>基于
            <a href="https://hexo.io/" target="_blank">Hexo</a> 的
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">hexo-theme-matery</a>主题搭建.

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">6.6k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:1046365166@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1046365166" class="tooltipped" data-tooltip="QQ联系我: 1046365166" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


</body>
</html>